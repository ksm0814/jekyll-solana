---
title: 인증 기반 개발
teaser: 세션으로 남의 정보는 건드리지 않기
category: programming
tags: [programming, mvc, session, database, sql]
---

### HttpSession을 사용해서 로그인과 로그아웃
<dfn></dfn>
세션 추가와 함께 <dfn>로그인</dfn>과 <dfn>로그아웃</dfn> 기능을 추가했다.

<br/><img src="../i/0123_1.png" style="width: 70%; height: auto;" /><br/>

<rb>HttpSession session</rb>으로 받아와서 로그인 성공한 user의 정보를 전달한다.

<dfn>HttpSessionUtils</dfn> 클래스는 session에서 처리해줄만한 일을 담당하고 세션키를

가지고있다.

<dfn>세션은 메소드를 전전해도 상태를 가지고 있기 때문에 </dfn> 필요할 때 가져와서 쓰면 되고

<br/><img src="../i/0123_2.png" style="width: 70%; height: auto;" /><br/>

로그아웃하면 removeAttribute로 정보를 날려주면 된다.

### 로그인 사용자에게만 해당하는 정보 보여주기

개인정보수정 화면에서 <dfn>수정</dfn>버튼을 누를때 매핑 메소드다.

<br/><img src="../i/0123_3.png" style="width: 70%; height: auto;" /><br/>

세션정보를 활용해 로그인됐는지 확인하고, 로그인 했다면 해당 유저를 찾아 받은 id 값과

일치하는지 확인한다.
<br/>

개인정보를 수정하고 나면

<br/><img src="../i/0123_4.png" style="width: 70%; height: auto;" /><br/>

데이터베이스에 정보를 업데이트하고 다시 리스트를 보여준다.

* userRepository에는 기본키로 해당 객체를 반환해주는 <mark>findOne</mark> 메소드가 있다.

<br/><img src="../i/0123_5.png" style="width: 70%; height: auto;" /><br/>

<mark>@AutoWired</mark>는 스프링에서 인터페이스인 userRepository에 대한

<dfn>구현체</dfn>를 가지고 있다가 저 표시를 보고 객체를 편히 쓸 수 있게 값을 할당해준다.

스프링이 알아서 해주는 부분이 많아서 다행이다!


### 쿠키와 세션

Http 프로토콜은 무상태다. 파일 전송용 프로토콜인 FTP는 인증 절차가 많아 오버헤드가 커서

빠른 정보 전달을 위한 프로토콜로 고안된게 Http고 제법 무뚝뚝한 방식이다.

책에서 보니 미용실로 비유를 하던데


* 무상태 미용실 : 어떻게 잘라 드릴까요? 짧게 잘라주세요

* 상태 유지 미용실 : 평소랑 똑같이 잘라주세요.

상태 유지 미용실의 요구를 들어주려면 <rb>평소 상태</rb>를 알아야 한다.

평소 상태를 구하기 위한 방법은 세단계로 진화하게 되는데,

<rb>1.</rb> url에 정보를 전달하기<br/>

<rb>2.</rb> 쿠키를 이용하기<br/>

<rb>3.</rb> 세션을 이용하기<br/>

첫번째 방법은 딱 봐도 보안의 취약점이 보인다. 옆사람이 내 컴퓨터 화면만 봐도 그냥 알 수 있을정도로

레벨이 낮다.

두번째 방법인 쿠키는 리퀘스트시 header에 포함된 작은 정보다. 쿠키 파일은 로컬 pc의 어딘가에 저장되고 

com.samskivert.mustache.MustacheException: Unable to load template: /include/fileHeader] with root cause

Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2
